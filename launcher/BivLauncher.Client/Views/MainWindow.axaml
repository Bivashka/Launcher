<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BivLauncher.Client.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        x:Class="BivLauncher.Client.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="{Binding ProductName}"
        Width="1240"
        Height="780"
        MinWidth="1040"
        MinHeight="680">

  <Grid>
    <Border Background="{Binding LauncherBackgroundBrush}" />
    <Image Source="{Binding BrandingBackgroundImage}"
           Stretch="UniformToFill"
           IsVisible="{Binding HasBrandingBackgroundImage}" />
    <Border Background="#FF000000"
            Opacity="{Binding BrandingBackgroundOverlayOpacity}"
            IsVisible="{Binding HasBrandingBackgroundImage}" />

    <Grid RowDefinitions="Auto,*" Margin="18">
    <Border Classes="heroPanel"
            Background="{Binding HeroBackgroundBrush}"
            BorderBrush="{Binding HeroBorderBrush}">
      <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
        <TextBlock Classes="heroTitle" Text="{Binding ProductName}" />
        <TextBlock Grid.Row="1" Classes="subtle" Text="{Binding Tagline}" Margin="0,6,0,0" />
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
          <Button Classes="ghostButton"
                  Content="{Binding RefreshButtonText}"
                  Command="{Binding RefreshCommand}"
                  IsVisible="{Binding IsLauncherReady}" />
          <Button Classes="iconButton"
                  Content="⚙"
                  Command="{Binding ToggleSettingsCommand}"
                  IsVisible="{Binding IsLauncherReady}" />
        </StackPanel>
      </Grid>
    </Border>

    <Grid Grid.Row="1" Margin="0,14,0,0">
      <Border Classes="loginCard"
              Width="{Binding LoginCardWidth}"
              HorizontalAlignment="{Binding LoginCardHorizontalAlignment}"
              VerticalAlignment="Center"
              Margin="24,0"
              Background="{Binding LoginCardBackgroundBrush}"
              BorderBrush="{Binding LoginCardBorderBrush}"
              IsVisible="{Binding IsLoginRequired}">
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="10">
          <TextBlock Classes="sectionTitle" Text="{Binding AccountHeaderText}" />
          <TextBlock Grid.Row="1" Classes="subtle" Text="{Binding StatusText}" TextWrapping="Wrap" />

          <TextBlock Grid.Row="2" Text="{Binding UsernameLabelText}" />
          <TextBox Grid.Row="3"
                   Watermark="Player"
                   Text="{Binding PlayerUsername}" />

          <TextBlock Grid.Row="4" Text="{Binding PasswordLabelText}" />
          <StackPanel Grid.Row="5" Orientation="Horizontal" Spacing="10">
            <TextBox Width="280"
                     Text="{Binding PlayerPassword}"
                     PasswordChar="*" />
            <Button Content="{Binding LoginButtonText}"
                    Command="{Binding LoginCommand}" />
          </StackPanel>

          <TextBlock Grid.Row="6"
                     Text="{Binding TwoFactorCodeLabelText}"
                     IsVisible="{Binding IsTwoFactorStepActive}" />
          <TextBox Grid.Row="7"
                   Width="280"
                   Watermark="123456"
                   Text="{Binding PlayerTwoFactorCode}"
                   IsVisible="{Binding IsTwoFactorStepActive}" />
          <TextBlock Grid.Row="8"
                     Classes="subtle"
                     Text="{Binding TwoFactorHintText}"
                     TextWrapping="Wrap"
                     IsVisible="{Binding IsTwoFactorStepActive}" />
        </Grid>
      </Border>

      <Grid IsVisible="{Binding IsLauncherReady}"
            ColumnDefinitions="*,380"
            ColumnSpacing="14">
        <Border Classes="featurePanel">
          <Grid RowDefinitions="Auto,Auto,Auto,Auto,*" RowSpacing="12">
            <TextBlock Classes="sectionTitle" Text="{Binding PlayButtonText}" />
            <TextBlock Grid.Row="1"
                       FontSize="24"
                       FontWeight="SemiBold"
                       Text="{Binding SelectedServer.DisplayName, TargetNullValue='No server selected'}"
                       TextWrapping="Wrap" />
            <TextBlock Grid.Row="2"
                       Classes="subtle"
                       Text="{Binding SelectedServer.AddressDisplay, TargetNullValue='-'}" />
            <TextBlock Grid.Row="3"
                       Classes="subtle"
                       Text="{Binding AuthStatusText}"
                       TextWrapping="Wrap" />
            <StackPanel Grid.Row="4"
                        Orientation="Horizontal"
                        Spacing="10"
                        VerticalAlignment="Bottom">
              <Button Classes="playButton"
                      Content="{Binding PlayButtonText}"
                      Background="{Binding PlayButtonBackgroundBrush}"
                      BorderBrush="{Binding PlayButtonBorderBrush}"
                      Command="{Binding LaunchCommand}" />
              <Button Content="{Binding OpenLogsFolderButtonText}"
                      Command="{Binding OpenLogsFolderCommand}" />
            </StackPanel>
          </Grid>
        </Border>

        <Grid Grid.Column="1" RowDefinitions="Auto,*" RowSpacing="12">
          <Border Classes="panel">
            <Grid RowDefinitions="Auto,*" RowSpacing="10">
              <TextBlock Classes="sectionTitle" Text="{Binding ServersHeaderText}" />
              <ListBox Grid.Row="1"
                       MaxHeight="290"
                       ItemsSource="{Binding ManagedServers}"
                       SelectedItem="{Binding SelectedServer}">
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <Grid Margin="0,2" ColumnDefinitions="40,*" ColumnSpacing="8">
                      <Border Width="34"
                              Height="34"
                              CornerRadius="8"
                              BorderBrush="#3A4F70"
                              BorderThickness="1"
                              VerticalAlignment="Top">
                        <Image Source="{Binding Icon}" Stretch="UniformToFill" />
                      </Border>
                      <Grid Grid.Column="1" RowDefinitions="Auto,Auto,Auto">
                        <TextBlock Text="{Binding DisplayName}"
                                   FontWeight="SemiBold"
                                   TextWrapping="Wrap" />
                        <TextBlock Grid.Row="1" Classes="subtle" Text="{Binding AddressDisplay}" />
                        <TextBlock Grid.Row="2" Classes="subtle" Text="{Binding LoaderType}" />
                      </Grid>
                    </Grid>
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>
            </Grid>
          </Border>

          <Border Grid.Row="1" Classes="panel">
            <Grid RowDefinitions="Auto,*" RowSpacing="10">
              <TextBlock Classes="sectionTitle" Text="{Binding NewsHeaderText}" />
              <ListBox Grid.Row="1"
                       ItemsSource="{Binding NewsItems}"
                       SelectedItem="{Binding SelectedNewsItem}">
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <Grid Margin="0,2" RowDefinitions="Auto,Auto,Auto">
                      <TextBlock Text="{Binding Title}"
                                 FontWeight="SemiBold"
                                 TextWrapping="Wrap" />
                      <TextBlock Grid.Row="1"
                                 Classes="subtle"
                                 Text="{Binding Meta}" />
                      <TextBlock Grid.Row="2"
                                 Classes="subtle"
                                 Text="{Binding Preview}"
                                 TextWrapping="Wrap"
                                 MaxHeight="44" />
                    </Grid>
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>
            </Grid>
          </Border>
        </Grid>
      </Grid>

      <Border IsVisible="{Binding IsSettingsOpen}"
              Background="#9A060A14">
        <Grid>
          <Border Classes="settingsDrawer"
                  HorizontalAlignment="Right"
                  Width="360">
            <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,*" RowSpacing="10">
              <Grid ColumnDefinitions="*,Auto">
                <TextBlock Classes="sectionTitle" Text="{Binding SettingsHeaderText}" />
                <Button Grid.Column="1"
                        Classes="iconButton"
                        Content="✕"
                        Command="{Binding CloseSettingsCommand}" />
              </Grid>

              <TextBlock Grid.Row="1" Text="{Binding LanguageLabelText}" />
              <ComboBox Grid.Row="2"
                        ItemsSource="{Binding LanguageOptions}"
                        SelectedItem="{Binding SelectedLanguageOption}" />

              <Button Grid.Row="3"
                      Content="{Binding SaveSettingsButtonText}"
                      Command="{Binding SaveSettingsCommand}" />

              <TextBlock Grid.Row="4"
                         Classes="sectionTitle"
                         Text="{Binding UpdateHeaderText}" />
              <TextBlock Grid.Row="5"
                         Classes="subtle"
                         Text="{Binding CurrentVersionText}" />
              <TextBlock Grid.Row="6"
                         Classes="subtle"
                         Text="{Binding LatestVersionText}" />

              <StackPanel Grid.Row="7" Spacing="8">
                <TextBlock Classes="subtle"
                           Text="{Binding UpdateAvailabilityText}" />
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Button Content="{Binding DownloadUpdateButtonText}"
                          Command="{Binding DownloadUpdateCommand}"
                          IsVisible="{Binding IsUpdateAvailable}" />
                  <Button Content="{Binding InstallUpdateButtonText}"
                          Command="{Binding InstallUpdateCommand}"
                          IsVisible="{Binding IsUpdateAvailable}" />
                </StackPanel>
                <Button Content="{Binding OpenUpdateButtonText}"
                        Command="{Binding OpenUpdateUrlCommand}"
                        IsVisible="{Binding IsUpdateAvailable}" />
                <TextBlock Classes="subtle"
                           Text="{Binding UpdateDownloadProgressText}"
                           TextWrapping="Wrap" />
                <TextBox Text="{Binding UpdateReleaseNotes}"
                         IsReadOnly="True"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         IsVisible="{Binding HasUpdateReleaseNotes}"
                         Height="90" />
                <Button Content="{Binding OpenLogsFolderButtonText}"
                        Command="{Binding OpenLogsFolderCommand}" />
              </StackPanel>
            </Grid>
          </Border>
        </Grid>
      </Border>
    </Grid>
  </Grid>
  </Grid>
</Window>
